<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>D3 Test</title>
	<script src="d3/d3.min.js"></script>
	<script src="d3/topojson.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
		}

		svg {
			position: absolute;
			width: 100%;
			height: 100%;
		}

		#zone-borders {
		  fill: none;
		  stroke-width: 1px;
		  stroke-linejoin: round;
		  stroke-linecap: round;
		  pointer-events: none;
	    }

		img.cam {
			display: block;
		}
	</style>
</head>
<body>
<script>
	
	//set up variables and functions we will need
	var width = window.innerWidth,
		height = window.innerHeight;

	var bgColor = "#fff";
	var zoneColor = "#aaa";
	var borderColor = "#000";

	var projectionFunc = d3.geo.mercator()	//world
		.scale(4000)
		.center([-119.6, 36.3])	//hnx coords
		.translate([width/6, height* 2/3]);

	var pathFunc = d3.geo.path()
		.projection(projectionFunc);

	var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", height);

	svg.append("rect")
		.attr("x", "0")
		.attr("y", "0")
		.attr("width", width)
		.attr("height", height)
		.attr("fill", bgColor);

	var gMap = svg.append("g");
	var gCams = svg.append("g");

	//get hnx map data and plot it
	d3.json("hnxSaZones.json", function(error, hnx) {
		if (error) throw error;

		var zones = topojson.feature(hnx, hnx.objects.hnxsaZones).features;
		gMap.selectAll("path")
				.data(zones)
			.enter()
				.append("path")
				.attr("id", "zones")
				.attr("fill", zoneColor)
				.attr("d", pathFunc);

		gMap.append("path")
	        .datum(topojson.mesh(hnx, hnx.objects.hnxsaZones, function(a, b) {
			    return a !== b;
		    }))
	        .attr("id", "zone-borders")
			.attr("stroke", borderColor)
	        .attr("d", pathFunc);

	});

	//set up the data
	var sampleCams = ["1.jpg", "2.jpg", "3.jpg", "4.jpg", "5.jpg"];
	var sampleCoords = [];
	d3.json("offlineData.json", function(error, data) {
		if (error) { console.log("An error has occured:" + error); }

		var stations = data.stations;
		for (var i = 0; i < sampleCams.length; i++) {
			sampleCoords.push( { "LAT" : stations[i].latitude, "LON" : stations[i].longitude } );
		}

	    gMap.selectAll("circle.camPoints")
	    	.data(sampleCoords)
	      .enter()
	    	.append("circle")
	    	.classed("camPoints", true)
	    	.attr("cx", function(d) {
	    		return projectionFunc( [d.LON, d.LAT] )[0];
	    	})
	    	.attr("cy", function(d) {
	    		return projectionFunc( [d.LON, d.LAT] )[1];
	    	})
	    	.attr("r", 4)
	    	.attr("fill", "#222");
	});

	gCams.selectAll("image.cam")
		.data(sampleCams)
	  .enter()
		.append("image")
		.classed("cam", true)
		.attr("x", width / 2)
		.attr("y", height / 2)
		.attr("xlink:href", function(d) { return d; })
		.attr("width", 200)
		.attr("height", 200);
		

</script>
</body>
</html>
